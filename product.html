<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Product Details</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<style>
#carousel img{width:100%;height:300px;object-fit:cover;cursor:zoom-in;}
#zoomed {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;z-index:50;}
#zoomed img{max-width:90%;max-height:90%;cursor:zoom-out;}
#toast {position:fixed;bottom:1rem;right:1rem;padding:1rem 1.5rem;background:#16a34a;color:white;border-radius:.5rem;display:none;z-index:60;}
</style>
</head>
<body class="bg-gray-100 p-4">

<div class="max-w-3xl mx-auto bg-white p-4 rounded shadow">
  <div id="carousel" class="mb-4"></div>
  <h1 id="pname" class="text-2xl font-bold mb-2"></h1>
  <p id="pdesc" class="text-gray-700 mb-2"></p>
  <p class="text-green-700 font-bold text-xl mb-2">₹<span id="pprice"></span></p>
  <p class="text-sm text-gray-500 mb-4">Stock: <span id="pstock"></span></p>
  <div class="flex gap-2">
    <button onclick="addToCart()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded flex-1">Add to Cart</button>
    <button onclick="payNow()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded flex-1">Buy Now</button>
  </div>
</div>

<div id="zoomed" onclick="closeZoom()"><img id="zoomedImg"></div>
<div id="toast"></div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/1-7MmarfUBcDmvZw38wd9cE9ZJjr4qedZHBnK_8a2yhg/export?format=csv";
const UPI_ID = "7093218658@ybl";
let productsMap={}, product={};

function showToast(msg){const t=document.getElementById('toast');t.innerText=msg;t.style.display='block';setTimeout(()=>t.style.display='none',2000);}

function parseCSVRow(row){
  const result=[]; let current="", insideQuotes=false;
  for(let i=0;i<row.length;i++){
    const char=row[i];
    if(char=='"' && row[i+1]=='"'){current+='"';i++;}
    else if(char=='"'){insideQuotes=!insideQuotes;}
    else if(char==',' && !insideQuotes){result.push(current); current="";}
    else{current+=char;}
  }
  result.push(current); return result;
}

const urlParams = new URLSearchParams(window.location.search);
const pid = urlParams.get('id');

fetch(CSV_URL).then(r=>r.text()).then(data=>{
  const rows=data.split("\n").slice(1);
  rows.forEach(r=>{
    const c=parseCSVRow(r);
    if(!c[0]) return;
    const p = {
      id:c[0], name:c[1], category:c[2], price:parseFloat(c[3]),
      stock:c[4], thumbnail:c[5], description:c[6], images:c[7]
    };
    productsMap[p.id]=p;
  });

  product=productsMap[pid];
  if(!product){alert("Product not found"); return;}
  document.getElementById('pname').innerText=product.name;
  document.getElementById('pdesc').innerText=product.description;
  document.getElementById('pprice').innerText=product.price;
  document.getElementById('pstock').innerText=product.stock;

  const carousel=document.getElementById('carousel');
  const imgs = product.images.split('|').filter(i=>i);
  imgs.forEach((img)=>{
    const im=document.createElement('img');
    im.src=img; im.onclick=()=>zoomImage(img);
    carousel.appendChild(im);
  });
});

function zoomImage(src){const z=document.getElementById('zoomed');document.getElementById('zoomedImg').src=src;z.style.display='flex';}
function closeZoom(){document.getElementById('zoomed').style.display='none';}

function addToCart(){
  let cart=JSON.parse(localStorage.getItem('cart'))||{};
  cart[product.id]=(cart[product.id]||0)+1;
  localStorage.setItem('cart',JSON.stringify(cart));
  showToast("Added to cart!");
}

function payNow(){
  let msg=`Payment for product:\n${product.name} x1 = ₹${product.price}\nTotal: ₹${product.price}`;
  const upiLink=`upi://pay?pa=${UPI_ID}&pn=Rajesh Kumar&am=${product.price}&cu=INR&tn=${encodeURIComponent(msg)}`;
  window.location.href=upiLink;
}
</script>
</body>
</html>
