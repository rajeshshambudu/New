<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Amazon Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<header class="bg-blue-900 text-white p-4 text-center font-bold text-xl">
Mini Amazon Store
</header>

<div class="max-w-7xl mx-auto p-4">

  <!-- Filters -->
  <div class="flex flex-col md:flex-row gap-4 mb-4 items-center">
    <select id="categoryFilter" class="p-2 rounded border">
      <option value="">All Categories</option>
    </select>

    <select id="priceSort" class="p-2 rounded border">
      <option value="">Sort by Price</option>
      <option value="asc">Low → High</option>
      <option value="desc">High → Low</option>
    </select>
  </div>

  <!-- Product Grid -->
  <div id="products" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>

</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/1-7MmarfUBcDmvZw38wd9cE9ZJjr4qedZHBnK_8a2yhg/export?format=csv";
let products = [];

function parseCSVRow(row){
  const result = [];
  let current="", insideQuotes=false;
  for(let i=0;i<row.length;i++){
    const char=row[i];
    if(char=='"' && row[i+1]=='"'){current+='"';i++;}
    else if(char=='"'){insideQuotes=!insideQuotes;}
    else if(char==',' && !insideQuotes){result.push(current); current="";}
    else{current+=char;}
  }
  result.push(current);
  return result;
}

fetch(CSV_URL)
.then(r=>r.text())
.then(data=>{
  const rows=data.split("\n").slice(1);
  products = rows.map(r=>{
    const c=parseCSVRow(r);
    return {id:c[0], name:c[1], category:c[2], price:parseFloat(c[3]), stock:c[4], thumbnail:c[5], description:c[6], images:c[7]};
  }).filter(p=>p.id);

  populateCategoryFilter();
  renderProducts(products);
});

function populateCategoryFilter(){
  const unique = [...new Set(products.map(p=>p.category))];
  const select = document.getElementById("categoryFilter");
  unique.forEach(cat=>{
    const opt=document.createElement("option");
    opt.value=cat; opt.textContent=cat;
    select.appendChild(opt);
  });
}

function renderProducts(data){
  const grid = document.getElementById("products");
  if(data.length===0){ grid.innerHTML="<p class='text-center text-gray-500 col-span-4'>No products found</p>"; return; }
  grid.innerHTML = data.map(p=>`
    <div class="bg-white rounded-xl shadow p-3 hover:shadow-lg transition">
      <a target="_blank" href="product.html?id=${p.id}">
        <img src="${p.thumbnail}" class="h-40 w-full object-cover rounded">
      </a>
      <h3 class="font-bold mt-2 text-sm">${p.name}</h3>
      <p class="text-xs text-gray-500">${p.category}</p>
      <div class="text-green-700 font-bold mt-1">₹${p.price}</div>
      <div class="text-xs mt-1 ${p.stock=='In Stock'?'text-green-600':'text-red-600'}">
        ${p.stock}
      </div>
    </div>
  `).join("");
}

document.getElementById("categoryFilter").addEventListener("change", applyFilters);
document.getElementById("priceSort").addEventListener("change", applyFilters);

function applyFilters(){
  const cat = document.getElementById("categoryFilter").value;
  const sort = document.getElementById("priceSort").value;

  let filtered = [...products];
  if(cat) filtered = filtered.filter(p=>p.category===cat);

  if(sort==='asc') filtered.sort((a,b)=>a.price-b.price);
  if(sort==='desc') filtered.sort((a,b)=>b.price-a.price);

  renderProducts(filtered);
}
</script>

</body>
</html>
